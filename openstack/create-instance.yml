---
- name : Create Initial Instances
  hosts : localhost
  tasks :
          - name: Create Sample Openstack Instances
            os_server:
                    state: present
                    auth:
                        auth_url: "{{ lookup('env','OS_AUTH_URL') }}"
                        username: "{{ lookup('env','OS_USERNAME') }}"
                        password: "{{ lookup('env','OS_PASSWORD') }}"
                        project_name: "{{ project_name }}"
                    name: "{{ project_name }}-df-server-{{ item }}"
                    image: "{{ image_id }}"
                    timeout: 600
                    flavor: 2
                    nics:
                        - net-id: "{{ net_id }}"
                    auto_ip: no
            loop: "{{ server_counts }}"

          - name: get openstack instances
            os_server_info:
                    server: "{{ project_name }}-df-server*"
            
            register: info_result
          - debug:
                    msg: "{{ item.hostname }} {{ item.vm_state }}"
            loop: "{{ info_result.openstack_servers }}"
